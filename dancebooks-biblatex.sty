\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{dancebooks-biblatex}[2012/12/31 Special package for formatting of BIB labels]

\RequirePackage[utf8]{inputenc}
\RequirePackage[T2A]{fontenc}
\RequirePackage{csquotes}
\RequirePackage[hyphens]{url}
\RequirePackage[unicode]{hyperref}

\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=dancebooks,prefix=dancebooks@}
\DeclareStringOption{root}
\ProcessKeyvalOptions{dancebooks}

\RequirePackage[czech,danish,english,french,german,italian,polish,portuguese,spanish,russian]{babel}
\RequirePackage[bibencoding=cp1251,style=gost-authoryear,backend=biber,babel=other,ibidtracker=false]{biblatex}

\renewbibmacro*{date}{\printdate}%
\renewbibmacro*{year}{\printfield{year}}

\renewbibmacro*{cite}{%
\iffieldundef{shorthand}%
{\printnames{labelname}\setunit{\nameyeardelim}\printfield{year}\printfield{extrayear}}%
{\printfield{shorthand}\setunit{\nameyeardelim}\printfield{year}\printfield{extrayear}}%
}

\renewbibmacro*{begentry}{\brackettext{%
\iffieldundef{shorthand}%
{\printnames{labelname}\setunit{\nameyeardelim}\printfield{year}\printfield{extrayear}}%
{\printfield{shorthand}\setunit{\nameyeardelim}\printfield{year}\printfield{extrayear}}%
}\addnbspace}

\addbibresource{\dancebooks@root/american.bib}
\addbibresource{\dancebooks@root/anuario-musical.bib}
\addbibresource{\dancebooks@root/australian.bib}
\addbibresource{\dancebooks@root/czech.bib}
\addbibresource{\dancebooks@root/danish.bib}
\addbibresource{\dancebooks@root/dutch.bib}
\addbibresource{\dancebooks@root/english.bib}
\addbibresource{\dancebooks@root/french.bib}
\addbibresource{\dancebooks@root/german.bib}
\addbibresource{\dancebooks@root/hda.bib}
\addbibresource{\dancebooks@root/images.bib}
\addbibresource{\dancebooks@root/italian.bib}
%\addbibresource{\dancebooks@root/journal-of-musicology.bib}
\addbibresource{\dancebooks@root/polish.bib}
\addbibresource{\dancebooks@root/portuguese.bib}
\addbibresource{\dancebooks@root/problems.bib}
\addbibresource{\dancebooks@root/rothenfelser.bib}
\addbibresource{\dancebooks@root/russian.bib}
\addbibresource{\dancebooks@root/spanish.bib}
\addbibresource{\dancebooks@root/spbconf.bib}