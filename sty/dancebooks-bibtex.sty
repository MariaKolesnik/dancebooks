\NeedsTeXFormat{LaTeX2e}

\RequirePackage[square]{natbib}
\RequirePackage{ifthen}
\RequirePackage[hyphens]{url}
\RequirePackage[unicode]{hyperref}
\RequirePackage[T2A]{fontenc}
\RequirePackage[english,russian]{babel}

\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=dancebooks,prefix=dancebooks@}
\DeclareStringOption{root}
\ProcessKeyvalOptions{dancebooks}

\ProvidesPackage{\dancebooks@root/sty/dancebooks-bibtex}[2012/12/31 Special package for formatting of BIB labels]
\fontfamily{cmr}\selectfont

\newcommand\parencite{\citep}

% format lengths
\renewcommand\NAT@bibsetup[1]{%
   \setlength{\labelwidth}{3em}%
   \setlength{\leftmargin}{\labelwidth}%
%   \setlength{\itemindent}{0pt}%
   \addtolength{\leftmargin}{\labelsep}%
   \setlength{\itemsep}{\bibsep}\setlength{\parsep}{\z@}%
}

\def\@sbb@biblabel#1#2#3{[#3\if\relax#2\relax\else,~#2\fi]}
\newcommand\sbb@biblabel{\expandafter\@sbb@biblabel}

\def\@lbibitem[#1]#2{%
  \if\relax\@extra@b@citeb\relax\else
    \@ifundefined{br@#2\@extra@b@citeb}{}{%
     \@namedef{br@#2}{\@nameuse{br@#2\@extra@b@citeb}}}\fi
   \@ifundefined{b@#2\@extra@b@citeb}{\def\NAT@num{}}{\NAT@parse{#2}}%
   \item[\hfil\hyper@natanchorstart{#2\@extra@b@citeb}%
% here was just
%\@biblabel{\NAT@num}%
% I replaced it with:
    \@ifundefined{b@#2\@extra@binfo}{[{\bfseries{}??}]}
		{\expandafter\sbb@biblabel\csname b@#2\@extra@binfo\endcsname}\hfil
%end
    \hyper@natanchorend]%
    \NAT@ifcmd#1(@)(@)\@nil{#2}}

%подключение библиографии в одну строку
\providecommand{\printbibliography}[1][\dancebooks@root/bib/empty]{%
\bibliographystyle{\dancebooks@root/bst/gost-authoryear}%
\bibliography{%
\dancebooks@root/bib/american,%
\dancebooks@root/bib/anuario-musical,%
\dancebooks@root/bib/australian,%
\dancebooks@root/bib/canadian,%
\dancebooks@root/bib/czech,%
\dancebooks@root/bib/danish,%
\dancebooks@root/bib/dutch,%
\dancebooks@root/bib/english,%
\dancebooks@root/bib/french,%
\dancebooks@root/bib/german,%
\dancebooks@root/bib/hda,%
\dancebooks@root/bib/italian,%
%\dancebooks@root/bib/journal-of-musicology,%
\dancebooks@root/bib/polish,%
\dancebooks@root/bib/portuguese,%
\dancebooks@root/bib/problems,%
\dancebooks@root/bib/rothenfelser,%
\dancebooks@root/bib/russian,%
\dancebooks@root/bib/spanish,%
\dancebooks@root/bib/spbconf,%
#1}}