{% set fields = [
	"author",
	"shorthand",
	"title",
	"langid",
	"id",
	"added_on",
	"source",
	"booktype",
	"year",
	"publisher",
	"location",
	"edition",
	"series",
	"keywords",
	"url",
	"filename",
	"note",
	"annotation",
] %}

{% set useless_keywords = [
	"reissue",
	"transcription",
	"research",
	"commentary"
	"facsimile"
]|as_set %}
{% set keywords_warn_min_year = 1800 %}
{% set keywords_warn_max_year = 1900 %}

{% for param in fields %}
{# Some parameters require specific treatment #}
{% if param in ["filename", "author", "added_on", "url", "keywords"] %}
{% set value = item.get(param) %}
{% else %}
{% set value = item.get_as_string(param) %}
{% endif %}
{% if value %}

{% if (param != "filename") or show_secrets %} {# secrets filtering: start #}
			<div class="bib_item_left">{{ _("item:labels:" + param) }}:</div>
			<div class="bib_item_right">
{% if param == "id" %}
				<a href="/bib/books/{{ value }}">{{ value }}</a>
{% elif param == "author" %}
				{{ value|map("author_link")|map("safe")|join(", ") }}
{% elif param == "keywords" %}
				{{ value|map("keyword_link")|map("safe")|join(", ") }}
{% elif param == "url" %}
				<ul>
{% for url in value %}
					<li><a href="{{ url }}">{{ url }}</a></li>
{% endfor %}
				</ul>
{% elif param == "filename" %}
				<ul>
{% for filename in value %}
					<li>{{ filename }}</li>
{% endfor %}
				</ul>
{% elif param == "series" %}
{% set extra_value = item.get("number") %}
{% if extra_value %}
				{{ value }} {{ _("item:labels:number") }}{{ extra_value }}
{% else %}
				{{ value }}
{% endif %}

{% elif param == "langid" %}
				{{ _("item:language:" + value) }}

{% elif param == "added_on" %}
				{{ value | dateformat("long") }}
{% elif param == "annotation" %}
				{{ value | safe }}
{% else %}
				{{ value }}
{% endif %}
			</div>
{% endif %}
{% endif %} {# secrets filtering: end #}
{% endfor %}

{% set keywords = (item.get("keywords") or [])|as_set %}
{% set year_from = item.get("year_from") %}
{% set year_to = item.get("year_to") %}
{% if (
	(
		(year_from < keywords_warn_max_year) and
		(year_to > keywords_warn_min_year)
	) and
	(keywords - useless_keywords)|length == 0
) %}
			<div class="center warn">
				{{ _("interface:no_keywords")|safe }}
			</div>
{% endif %}

